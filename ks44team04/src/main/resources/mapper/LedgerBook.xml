<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ks44team04.mapper.LedgerBookMapper">

	<resultMap type="Order" id="orderResultMap">
		<id     column="order_num" 				 property="orderNum"/>
		<result column="buyer_id"  				 property="buyerId"/>
		<result column="coupon_code" 			 property="couponCode"/>
		<result column="order_date" 			 property="orderDate"/>
		<result column="order_status" 			 property="orderStatus"/>
		<result column="total_sum"  			 property="totalSum"/>
		<result column="total_price"  			 property="totalPrice"/>
		<result column="coupon_price" 			 property="couponPrice"/>
		<result column="use_point"   			 property="usePoint"/>
		<result column="goods_discount_price"    property="goodsDiscountPrice"/>
		<result column="post_price"   			 property="postPrice"/>
		<result column="total_order_price"  	 property="totalOrderPrice"/>
		<result column="final_confirm_price" 	 property="finalConfirmPrice"/>
		<result column="final_confirm_date"  	 property="finalConfirmDate"/>
		<result column="post_address_list"  	 property="postAddressList"/>
			<association property="OrderDetailDto" javaType="OrderDetail" >
	        	<id     column="order_detail_code" property="orderDetailCode"/>
	        </association>
			<association property="GoodsDto" javaType="Goods" >
	        	<id     column="goods_code" property="goodsCode"/>
	        	<result column="seller_id" 	 property="sellerId"/>
	        </association>
	</resultMap>
	
		

<!-- 메인 화면 2022 결제 금액 테이블  -->
<select id="orderList" parameterType="map" resultMap="orderResultMap" >
/*메인 화면 2022 결제 금액 테이블*/	
	SELECT 
			MONTH(o.order_date) AS `order_date`, 
    	    SUM(o.total_sum) AS `total_sum`,
    	    SUM(o.post_price) AS `post_price`
		FROM 
		  	tb_order AS o
			INNER JOIN 
			tb_order_detail AS od
			on
			o.order_num = od.order_num
			INNER JOIN 
			tb_goods AS g
			on
			od.goods_code = g.goods_code
		WHERE
			g.seller_id  = #{sellerId}  AND  YEAR(NOW()) = YEAR(o.order_date)
		GROUP BY MONTH(o.order_date);		
</select>

<!-- 메인 화면 2022년 할인 통계 포인트 부분 -->
<select id="pointDiscountlist" parameterType="map" resultMap="orderResultMap" >
	/*메인 화면 2022년 할인 통계 포인트/쿠폰 부분*/			
		SELECT 
			MONTH(o.order_date) AS `order_date`
			,SUM(o.coupon_price) AS `coupon_price`
    	    ,SUM(o.use_point) AS `use_point`
		FROM 
		  	tb_order AS o
			INNER JOIN 
			tb_order_detail AS od
			on
			o.order_num = od.order_num
			INNER JOIN 
			tb_goods AS g
			on
			od.goods_code = g.goods_code
		WHERE
			g.seller_id  = #{sellerId}  AND  YEAR(NOW()) = YEAR(o.order_date)
		GROUP BY MONTH(o.order_date);		
</select>

<!-- 메인 화면에 차트 부분 -->
<select  id="mainCartlist" parameterType="map" resultMap="orderResultMap">
/* 메인 화면에 차트 부분 */
	SELECT
		DATE_FORMAT(o.order_date,'%Y.%m.%d')  AS `order_date`
		,sum(o.goods_discount_price) AS `goods_discount_price`
		,sum(o.total_price) AS `total_price`
	FROM 
	  	tb_order AS o
		INNER JOIN 
		tb_order_detail AS od
		on
		o.order_num = od.order_num
		INNER JOIN 
		tb_goods AS g
		on
		od.goods_code = g.goods_code
	WHERE
	 o.order_date BETWEEN DATE_ADD(NOW(),INTERVAL -1 WEEK ) AND NOW() AND g.seller_id = #{sellerId}
	GROUP BY DATE_FORMAT(o.order_date,'%Y.%m.%d');
</select>


</mapper>