<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/adminDefault}">
	

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
</th:block>

<th:block layout:fragment="customCss">

<style>
.modal {
  text-align: center;
  padding: 0!important;
}
.modal:before {
  content: '';
  display: inline-block;
  height: 100%;
  vertical-align: middle;
  margin-right: -4px;
}
.modal-dialog {
  display: inline-block;
  text-align: left;
  vertical-align: middle;
}
</style>
</th:block>

<th:block layout:fragment="customContents">
	<div class="page-title">
		<div class="title_left">
			<h3>상품 목록</h3>
		</div>
	</div>

	<div class="col-md-12 col-sm-12 col-xs-12">
		<div class="x_panel">
			<div class="x_title">
				<h5>
					검색 필터 <a class="collapse-link"><i class="fa fa-chevron-up"
						style="color: #b4b7ba;"></i></a>
				</h5>
				<div class="clearfix"></div>
			</div>

			<div class="x_content">
				<div class="well" style="overflow: auto">
					<div class="form-inline form-group" style="margin-bottom: -1px;">
						<label class="control-label" style="margin-right: 5px;">대분류</label>
							<select class="form-control">
						 		<th:block th:if="${not #lists.isEmpty(largeCategoryList)}" th:each="lcl : ${largeCategoryList}">
									<option th:value="${lcl.goodsLargeCategory}" th:text="${lcl.goodsCategory}">::</option>
								</th:block>
								<th:block th:unless="${not #lists.isEmpty(largeCategoryList)}">
									<option th:value="">등록된 카테고리가 없습니다.</option>
								</th:block>
							</select>
						<label class="control-label" for="qnaSearch" style="margin-left: 10px; margin-right: 5px;">중분류</label>
							<select class="form-control">
								<option>::</option>
							</select>
						<label style="margin-left: 10px;">상품코드
							<input type="text" class="form-control" size="10" style="margin-left: 5px;">
						</label>
						<label style="margin-left: 10px;">상품명
							<input type="text" class="form-control" size="10" style="margin-left: 5px;">
						</label>
						<label style="margin-left: 10px;">판매자
							<input type="text" class="form-control" size="10" style="margin-left: 5px; margin-right: 9px;">
						</label>
						<input type="checkbox" class="flat">품절
						<input type="checkbox" class="flat">판매중지
					<div style="text-align: center; margin-top:5px;">
						<button type="button" class="btn btn-dark">검색</button>
						<button type="reset" class="btn btn-dark">초기화</button>
					</div>
					</div>
				</div>
			</div>
				
	   <!-- <select th:each="lcl : ${largeCategoryList}">
				<th:block th:each="lsl : ${lcl.goodsSmallCategoryInfo}">
					<option th:text="${lsl.smallCategoryName}"></option>
				</th:block>
			</select> -->

			<div class="x_content2">
				<table id="datatable"
					class="table table-striped table-bordered bulk_action dataTable no-footer"
					role="grid">
					<thead>
						<tr style="text-align:center;">
							<th style="width: 100px;">상품코드</th>
							<th>상품명</th>
							<th style="width: 80px;">정가</th>
							<th style="width: 60px;">할인율</th>
							<th style="width: 80px;">할인가</th>
							<th style="width: 50px;">재고</th>
							<th style="width: 50px;">품절</th>
							<th style="width: 70px;">판매중지</th>
							<th style="width: 80px;">판매자</th>
							<th style="width: 60px;">신고수</th>
							<th style="width: 140px;">등록일</th>
							<th style="width: 110px;">관리</th>
						</tr>
					</thead>
					<tbody>
						<tr th:if="${not #lists.isEmpty(goodsList)}" th:each="g : ${goodsList}" id="goodsListTable">
							<td th:text="${g.goodsCode}"></td>
							<td th:text="${g.goodsName}"></td>
							<td th:text="${'₩' + #numbers.formatInteger(g.goodsPrice,3,'COMMA')}"></td>
							<td th:text="${g.goodsDiscountRate + '%'}"></td>
							<td th:text="${'₩'+ #numbers.formatInteger((g.goodsPrice-g.goodsPrice*g.goodsDiscountRate/100),3,'COMMA')}"></td>
							<td th:text="${g.goodsStock}"></td>
							<td th:text="${g.soldoutCheck}"></td>
							<td th:text="${g.stopSaleCheck}"></td>
							<td th:text="${g.userInfo.userId}"></td>
							<td th:text="${g.goodsReportAmount}"></td>
							<td th:text="${g.regDate}"></td>
							<td style="text-align: center;">
								<a th:href="@{/admin/goods/goodsModify(goodsCode=${g.goodsCode})}"><i class="fa fa-edit"></i> 수정</a>
								<a href="javascript:void(0);" class="Modal removeBtn" th:data-goods-code="${g.goodsCode}" data-toggle="modal" data-target="#removeModal">
									<i class="fa fa-close"></i> 삭제</a>
							</td>
						</tr>
						<tr th:unless="${not #lists.isEmpty(goodsList)}">
							<td colspan="11">등록된 상품이 없습니다.</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	
<form id="goodsDeleteForm" name="goodsDeleteForm" method="get" th:action="@{/admin/goods/goodsRemove}">
<div class="removeModal modal fade" id="removeModal" tabindex="-1" role="dialog" aria-labelledby="removeModalLabel" aria-hidden="true">
  <!-- <div class="modal-dialog modal-dialog-centered modal-sm" role="document"> -->
	<div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="removeModalLabel" style="font-weight: bold;">삭제하시겠습니까?</h5>
      </div>
      <div class="modal-body">
          <div class="form-group">
            <label for="adminPw" class="col-form-label">관리자 비밀번호</label>
            <input type="password" class="form-control" id="adminPw" name="adminPw">
            <p id="pwCheck" style="color:gray; font-weight: bold;"> </p>
          </div>
      </div>
      <div class="modal-footer" style="text-align: center;">
      	<input type="hidden" name="goodsCode" id="goodsCode">
        <button type="button" class="btn btn-dark" id="removeBtnCheck">확인</button>
        <button type="button" class="btn btn-secondary" id='closeBtn' data-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>
</form>
</th:block>


<th:block layout:fragment="customScript">

	<script th:inline="javascript">
	
	 $(function() {
		 /* 모달 열릴 때 이벤트 */
		$('.removeModal').on('show.bs.modal', function (event) {
			//var button = $(event.relatedTarget)
			//var modal = $(this)
			//var modalDialog = $(this).find(".modal-dialog");
			console.log('modal open');
		}); 
		/* 모달 닫을 때 안에 있는 데이터 초기화 */
		$('.removeModal').on('hidden.bs.modal', function(e) {
    		console.log('modal close');
    		document.forms['goodsDeleteForm'].reset();
			$('#pwCheck').text('');
		});
		/* 리스트에서 삭제 버튼 클릭 시 해당 상품 코드 가져오기 */
		$('.removeBtn').each(function(){
			$(this).click(function(){
				var goodsCode =  $(this).data("goods-code");
				$('#goodsCode').val( goodsCode );
			});
		});			
		/* 모달에서 확인 버튼 클릭 시 관리자 비밀번호 확인 유효성 검사 */
/*		$('#removeBtnCheck').click(function(){
			var adminPw = $('input[name="adminPw"]').val();
			
			if(typeof adminPw == 'undefined' || adminPw == null || adminPw == ''){
				$('#pwCheck').text('! 비밀번호를 입력해주세요.');
				$('input[name="adminPw"]').focus()
				return false;
				}if (adminPw != 'adminPw'){
					$('#pwCheck').text('! 비밀번호가 맞지 않습니다.');
					return false;
			}else if(adminPw == 'adminPw'){
				$('#goodsDeleteForm').submit();
			}
		}); 
	 });
	 
 	 $(document).ready(function(){
								
	
		
		$('#removeBtnCheck').click(function(){
			var adminPw = $('input[name="adminPw"]').val();
			
			var request = $.ajax({ 
			  	url: "goodsList.html",
			 	method: "POST",
			 	data: { "userPw":$('#adminPw').val() },
			 	success:function(result){
			 		if(result == 0){
			 			alert("실패");
			 			return false;
			 		}else {
			 			window.location.href = "/goods/goodsList"
			 		}
			 	error : function(jqXHR, status, error){
			 		alert("알 수 없는 에러 ["+ error +"]");
			 	}
			});
		});
	}); 
	 
	 


 //var largeCategoryList = /*[[${largeCategoryList}]]*/;
/*	 console.log(largeCategoryList)
	 
	 for(var small of largeCategoryList) {
		 console.log('LargeCategory : ' + small.goodsCategory);
		 //if(small.goodsCategory == '선택된 옵션') {
			 //console.log(small.goodsSmallCategoryInfo);
			 for(var smallName of small.goodsSmallCategoryInfo) {
				console.log('name : ' + smallName.smallCategoryName);
				console.log('value : ' + smallName.goodsSmallCategory);
				var name = smallName.smallCategoryName;
				var value = goodsSmallCategory;
				var option = `<option value:${value}>${name}</option>`
				$('#select').append(option);
				//만들고 append
		 	}
		 //}
	 }    */
	 
	 
	 
	</script>
</th:block> 
</html>