<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/adminDefault}">

<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
</th:block>

<th:block layout:fragment="customCss">
	<style>
		.loginInput {
			margin-bottom: 10px;
		}
  
		.userDetail td{
			padding-left: 12px !important;
		}
      
		.userDetail button {
			margin: 5px 3px 5px;
		}

		.tableOdd {
			background-color: #f6f6f6;
			font-weight: bold;
			padding-top: 20px !important;
		}
  
		.tableEven .text {
			width: 230px;
			margin: 3px;
		}
  
		.tableEven .select {
			width: 230px;
			margin: 3px;
		}

		.tableEven label {
			padding-top: 4px;
		}

		.text {
			margin-right: 6px;
		}
		
		.userAddr {
			width: 350px !important;
			margin-right: 6px;
		}
		
		.radioDiv {
			margin-left: 5px;
			margin-top: 6px;		
		}
		
		.checks {
			font-size: 12px;
			margin-left: 6px;
			border: 1px soild black;
		}
		
	</style>
</th:block>

<th:block layout:fragment="customContents">
	
	<form id="addUserForm" th:action="@{/admin/user/addUser}" method="post">
		<div class="page-title">
			<div class="title_left">
				<h3>회원등록</h3>
			</div>

			<div class="clearfix"></div>
			<div class="row">
				<div class="col-md-12 col-sm-12 col-xs-12">
					<div class="x_panel" style="padding-top: 30px;">
						<div class="x_content">

							<table class="userDetail table table-responsive" style="border-collapse: separate;">
								<tbody>
									<tr>
										<td class="tableOdd col-md-1">권한</td>
										<td class="tableEven">
										 	<select class="select form-control" id="userRight" name="userRight">
												<th:block th:unless="${#lists.isEmpty(rightList)}" th:each="r : ${rightList}">
													<option th:text="${r.rightStatus}" th:value="${r.userRight}"></option>
												</th:block>
											</select>
										</td>
										<td class="tableOdd col-md-1">회원등급</td>
										<td class="tableEven">
											<div class="form-inline">
	 											<select class="select form-control" id="userLevel" name="userLevel">
													<th:block th:unless="${#lists.isEmpty(levelBuyer)}" th:each="lb : ${levelBuyer}">
														<option th:text="${lb.levelName}" th:value="${lb.levelCode}"></option>
													</th:block>
													<th:block th:if="${#lists.isEmpty(levelBuyer)}">
														<option>등록된 회원등급이 없습니다.</option>
													</th:block>
												</select>
											</div>
										</td>
									</tr>
									<tr>
										<td class="tableOdd">아이디</td>
										<td class="tableEven col-md-4">
											<div class="form-inline">
												<input type="text" class="form-control text" id="userId" name="userId" data-ischecked="false" placeholder="아이디를 입력해주세요" />
	 											<span class="checks" id="idCheck"></span>
											</div>
										</td>
										<td class="tableOdd">비밀번호</td>
										<td class="tableEven col-md-4">
											<div class="form-inline">
												<input type="text" class="form-control text" id="userPw" name="userPw" placeholder="비밀번호입력" />
												<input type="text" class="form-control text" id="userPwCheck" name="userPwCheck" placeholder="비밀번호확인" />
											</div>
											<span class="checks" id="pwCheck1"></span>
											<span class="checks" id="pwCheck2"></span>
										</td>
									</tr>
									<tr>
										<td class="tableOdd">이름</td>
										<td class="tableEven col-md-4">
											<input type="text" class="form-control text" id="userName" name="userName" placeholder="이름을 입력해주세요" />
										</td>
										<td class="tableOdd">닉네임</td>
										<td class="tableEven col-md-4">
											<div class="form-inline">
												<input type="text" class="form-control text" id="userNickname" name="userNickname" placeholder="닉네임을 입력해주세요" />
												<span class="checks" id="nicknameCheck"></span>
											</div>
										</td>
									</tr>
									<tr>
										<td class="tableOdd">성별</td>
										<td class="tableEven col-md-4" colspan="3">
											<div class="radioDiv" style="margin-bottom: 5px;">
												<label>
													<input type="radio" id="userGender" name="userGender" value="여" /> 여자 &nbsp; &nbsp; &nbsp;
												</label>
												<label>
													<input type="radio" id="userGender" name="userGender" value="남" /> 남자
												</label>
											</div> 
										</td>
									</tr>
									<tr>
										<td class="tableOdd">이메일</td>
										<td class="tableEven col-md-4">
											<div class="form-inline">
												<input type="text" class="form-control text" id="userEmail" name="userEmail" placeholder="예:ksmart@gmail.com" />
												<span class="checks" id="emailCheck"></span>
											</div>
										</td>
										<td class="tableOdd">휴대폰번호</td>
										<td class="tableEven col-md-4">
											<div class="form-inline">
												<input type="text" class="form-control text" id="userPhone" name="userPhone" placeholder="숫자만 입력해주세요" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" maxlength="11"/>
												<span class="checks" id="phoneCheck"></span>
											</div>
										</td>
									</tr>
									<tr>
										<td class="tableOdd">주소</td>
										<td class="tableEven col-md-4" colspan="3">
											<div class="form-inline">
												<input type="text" class="userAddr form-control addr" id="userAddress" name="userAddress" placeholder="주소를 검색해주세요" readonly="readonly" /> 
												<input type="text" class="userAddr form-control addr" id="userAddress2" name="userAddress2" placeholder="상세주소를 입력해주세요" />
												<button type="button" class="btn" id="addrSearchBtn">주소검색</button>
											</div>
										</td>
									</tr>
									<tr>
										<td class="tableOdd">포인트</td>
										<td class="tableEven col-md-4">
											<input type="text" onkeyup="commas(this)" class="form-control text" id="userPoint" name="userPoint" value="0" />
										</td>
										<td class="tableOdd">벌점</td>
										<td class="tableEven col-md-4">
											<input type="text" class="form-control text" id="userPenalty" name="userPenalty" value="0" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
										</td>
									</tr>
									<tr>
										<td class="tableOdd">상태</td>
										<td class="tableEven col-md-4">
											<select class="select form-control" id="userStatus" name="userStatus">
												<option value="정상">정상</option>
												<option value="휴면">휴면</option>
												<option value="정지">정지</option>
											</select>
										</td>
										<td class="tableOdd">정보보관기간</td>
										<td class="tableEven col-md-4">
											<div class="radioDiv">
												<label>
													<input type="radio" name="userInfoKeep" value="탈퇴시까지" /> 탈퇴시까지 &nbsp; &nbsp; &nbsp;
												</label>
												<label>
													<input type="radio" name="userInfoKeep" value="1년" /> 1년
												</label>
											</div> 
										</td>
									</tr>
								</tbody>
							</table>
							
							<div class="form-group">
		                        <div style="text-align:center; margin: 30px;" >
									<button type="button" class="btn btn" th:onclick="|location.href='@{/admin/user/userList}'|">취소</button>
									<button type="submit" id="addUserBtn" class="btn btn-dark addUserBtn">등록</button>
								</div>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
</th:block>

<th:block layout:fragment="customJsScript">
	<th:block th:replace="/fragments/userJs :: datatablesFragment"></th:block>

	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
    
    	/* 유효성검사 */
		var idCheck = false;
		var pwCheck = false;
		var pw2Check = false;
		var pw2CorCheck = false; 
		var NameCheck = false; 
		var nicknameCheck = false;
		var genderCheck = false;
		var emailCheck = false;
		var phoneCheck = false;
		var addressCheck = false;
		var address2Check = false;
		var pointCheck = false;
		var penaltyCheck = false;
		var statusCheck = false; 
		var infoKeepCheck = false;
		
		$(document).ready(function() {
			 //가입버튼 기능 작동
			$(".addUserBtn").click(function(){
		        /* 입력값 변수 */
				var userId = $('#userId').val()
				var userPw = $('#userPw').val()
				var userPwCheck = $('#userPwCheck').val()
				var userName = $('#userName').val()
				var userNickname = $('#userNickname').val()
				var userGender = $('#userGender').val()
				var userEmail = $('#userEmail').val()
				var userPhone = $('#userPhone').val()
				var userAdress = $('#userAdress').val()
				var userAdress2 = $('#userAdress2').val()
				var userPoint = $('#userPoint').val()
				var userPenalty = $('#userPenalty').val()
				var userStatus = $('#userStatus').val()
				var userInfoKeep = $('#userInfoKeep').val()
			        
				/* 아이디 유효성검사 */
		        if(userId == ""){
		            alert('아이디를 입력해주세요');
		            $("#userId").focus();
		            idCheck = false;
		        }else{
		            $('#idCheck').css('display', 'none');
		            idCheck = true;
		        }
				
				
				
				
				
		        //$("#addUserForm").attr("action", "/admin/user/userList");
		        //$("#addUserForm").submit();
			});
			 
		});
    
    
    	/* 주소 검색 */
		let text = document.querySelector('#userAddress');
		document.querySelector('#addrSearchBtn').addEventListener('click', function () {
			
			new daum.Postcode({
				oncomplete: function (data) {
				text.value = data.address;
				}
			}).open();
			
			//상세주소 초기화
			var input = document.getElementById('userAddress2'); 
			input.value = null;
		});
		
		/* 전화번호 입력시 자동 대시(-) */
/* 		$(document).on("keyup", ".phoneNumber", function() { 
			$(this).val( $(this).val().replace(/[^0-9]/g, "").replace(/(^02|^0505|^1[0-9]{3}|^0[0-9]{2})([0-9]+)?([0-9]{4})$/,"$1-$2-$3").replace("--", "-") ); 
		}); */
		
		/* 포인트 숫자만 입력 + 3자리마다 콤마 */
		function commas(t) {
			// 콤마 빼기
			var x = t.value;			
			x = x.replace(/,/gi, '');
			// 숫자 정규식 확인
			var regexp = /^[0-9]*$/;
			if(!regexp.test(x)) { 
				$(t).val(""); 
			}else {
				x = x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");			
				$(t).val(x);			
			}
		}
		
		/* 권한 판매자 승인전 선택시 등급 select박스 제어 */
		$('#userRight').change(function() {
			
			 if($(this).val() == "buyer") {
				 $('#userLevel,#userPoint,#userPenalty').removeAttr('disabled')
				 $("#userLevel option[value='선택불가']").remove();
				 
			 }else if($(this).val() == "seller_before") {
				 $('#userLevel,#userPoint,#userPenalty').attr('disabled', 'disabled');
				 $("#userLevel").prepend("<option value='선택불가'>선택불가</option>");
				 $("#userLevel").val("선택불가").prop("selected", true);
				 //$('#userLevel').prop('value', 'null');
				 $('#userPoint').prop('value', 0);
				 $('#userPenalty').prop('value', 0);
			 }
		});
		
		

 		$(function() {
			
 			$('.checks').hide();
 			
			function vaildationCheck(data) {
				var isValid = true;	  					
				//유효성검사
				if(typeof data == 'object') {
					$.each(data, function() {
						var inputValue = $(this).val();
						if(typeof inputValue == 'undefined' || inputValue == null || inputValue == '') {
							isValid = false;
							var inputId = $(this).attr('id');
							var alertMsg = $('label[for="'+ inputId +'"]').text();
							alert(alertMsg + '를 입력해주세요');
							$(this).focus();
							return false; //이벤트를 종료시키기 위함
						}
					});
				}
				if(typeof data == 'string'){
					if(typeof data == 'undefined' || data == null || data == '') {
						isValid = false;
						return false;
					}
				}
				return isValid;
			}
			
			
			/* id 중복체크 - ajax 비동기처리 */			
			$("#userId").on('keyup',function() {
			
				var userId = $('#userId').val();
				var result = vaildationCheck(userId);
				
				// 정규표현식 (@, . 포함)
				function id_check( id ) {
				    var regex= /^[a-z][a-z\d]{5,15}$/;
				    return (id != '' && id != 'undefined' && regex.test(id));
				}
				
				$('.checks').show();
				
				if(!result) {
					$('#idCheck').css('color','#f03f40');
	                $('#idCheck').html("* 아이디를 입력해주세요.");
	                $('#userId').css('border','1px solid #f03f40');
					$('#userId').focus();
					return false;
				}else {
					if(! id_check(userId)) {
						$('#idCheck').css('color','#f03f40');
		                $('#idCheck').html("* 6~16자의 영문 소문자, 숫자만 입력해주세요");
		                $('#userId').css('border','1px solid #f03f40');
						$('#userId').focus();
					}else {
						$.ajax({
							url: '/admin/user/idCheck',
							method: 'GET',
							data: { 'userId' : userId },
							//dataType: "json",  //String이면 text   //text, json, xml, html
							success : function(cnt) {
								if(cnt == 0){
									$('#idCheckBtn').attr('data-isChecked', true);
					                $('#idCheck').css('color','#36ae36');
					                $('#idCheck').html("* 사용 가능한 아이디입니다.");
					                $('#userId').css('border','1px solid #36ae36');
									//$('#addUserForm button').prop('disabled', false);
								}else {
									$('#idCheck').css('color','#ff696a');
					                $('#idCheck').html("* 이미 사용중인 아이디입니다.");
									$('#userId').css('border','1px solid #f03f40');
									$('#userId').focus();
								}	
							}
						});
					}
				}
			});

			
		  	//비밀번호 유효성검사
            $("#userPw").on("propertychange change keyup paste input",function(){
               
            	var regex = /^[A-Za-z\d]{5,15}$/;
                var userPw = regex.exec($("#userPw").val())
                $('.checks').show();
                
                if(userPw != null){
                	$('#userPw').css('border','1px solid #50B55F');
                	$('#pwCheck1').css('color','#50B55F');
                	$('#pwCheck1').html('* 사용 가능한 비밀번호입니다.');
                }else{
                	$('#userPw').css('border','1px solid #f03f40');
                	$('#pwCheck1').css('color','#ff696a');
                	$('#pwCheck1').html('* 6~16자의 영문 대소문자, 숫자만 입력해주세요.');
                }
            });
			
			/* 비밀번호 확인 */
 			$('#userPwCheck').on("propertychange change keyup paste input",function() {
				
				var userPw = $('#userPw').val();
				var userPwCheck = $('#userPwCheck').val();
				$('.checks').show();
				
				if(userPw == userPwCheck) {
					$('#userPwCheck').css('border','1px solid #50B55F');
                	$('#pwCheck2').css('color','#50B55F');
                	$('#pwCheck2').html('* 비밀번호가 일치합니다.');
					return true;
				}else{
					$('#userPwCheck').css('border','1px solid #f03f40');
                	$('#pwCheck2').css('color','#ff696a');
                	$('#pwCheck2').html('* 비밀번호가 일치하지 않습니다.');
					return false;
				}
			});
            
			//닉네임 중복체크
			$("#userNickname").on('keyup',function() {
			
				var userNickname = $('#userNickname').val();
				var result = vaildationCheck(userNickname);
				$('.checks').show();
				
				if(!result) {
					$('#nicknameCheck').css('color','#f03f40');
	                $('#nicknameCheck').html("* 닉네임을 입력해주세요.");
	                $('#userNickname').css('border','1px solid #f03f40');
					$('#userNickname').focus();
					return false;
				}else {
					$.ajax({
						url: '/admin/user/nicknameCheck',
						method: 'GET',
						data: { 'userNickname' : userNickname },
						//dataType: "json",  //String이면 text   //text, json, xml, html
						success : function(cnt) {
							if(cnt == 0){
				                $('#nicknameCheck').css('color','#36ae36');
				                $('#nicknameCheck').html("* 사용 가능한 닉네임입니다.");
				                $('#userNickname').css('border','1px solid #36ae36');
								//$('#addUserForm button').prop('disabled', false);
							}else {
								$('#nicknameCheck').css('color','#f03f40');
				                $('#nicknameCheck').html("* 이미 사용중인 닉네임입니다.");
				                $('#userNickname').css('border','1px solid #f03f40');
								$('#userNickname').focus();
							}	
						}
					});
				}
			});
			
			//이메일 중복체크
			$("#userEmail").on('keyup',function() {
				
				var userEmail = $('#userEmail').val();
				var result = vaildationCheck(userEmail);
				
				// 정규표현식 (@, . 포함)
				function email_check( email ) {
				    var regex=/^01(?:0|1|[6-9])-(?:\d{3}|\d{4})-\d{4}$/;
				    return (email != '' && email != 'undefined' && regex.test(email));
				}
				
				$('.checks').show();
				
				if(!result) {
					$('#emailCheck').css('color','#f03f40');
	                $('#emailCheck').html("* 이메일을 입력해주세요.");
	                $('#userEmail').css('border','1px solid #f03f40');
					$('#userEmail').focus();
					return false;
				}else {
					if(! email_check(userEmail)) {
						$('#emailCheck').css('color','#f03f40');
		                $('#emailCheck').html("* 잘못된 형식의 이메일입니다.");
		                $('#userEmail').css('border','1px solid #f03f40');
						$('#userEmail').focus();
					}else {
						$.ajax({
							url: '/admin/user/emailCheck',
							method: 'GET',
							data: { 'userEmail' : userEmail },
							//dataType: "json",  //String이면 text   //text, json, xml, html
							success : function(cnt) {
								if(cnt == 0){
					                $('#emailCheck').css('color','#36ae36');
					                $('#emailCheck').html("* 사용 가능한 이메일입니다.");
					                $('#userEmail').css('border','1px solid #36ae36');
					                
									//$('#addUserForm button').prop('disabled', false);
								}else {
									$('#emailCheck').css('color','#f03f40');
					                $('#emailCheck').html("* 이미 사용중인 이메일입니다.");
					                $('#userEmail').css('border','1px solid #f03f40');
									$('#userEmail').focus();
								}	
							}
						});
						
					}
					
				}
			});
			
			//전화번호 중복체크
			$("#userPhone").on('keyup',function() {
				
				//숫자만 입력, 전화번호 입력시 자동 대시(-)
				
				var userPhone = $('#userPhone').val();
				var result = vaildationCheck(userPhone);
				$('.checks').show();
				
				if(!result) {
					$('#phoneCheck').css('color','#f03f40');
	                $('#phoneCheck').html("* 휴대폰번호를 입력해주세요.");
	                $('#userPhone').css('border','1px solid #f03f40');
					$('#userPhone').focus();
					return false;
				}else {
					$.ajax({
						url: '/admin/user/phoneCheck',
						method: 'GET',
						data: { 'userPhone' : userPhone },
						//dataType: "json",  //String이면 text   //text, json, xml, html
						success : function(cnt) {
							if(cnt == 0){
				                $('#phoneCheck').css('color','#36ae36');
				                $('#phoneCheck').html("* 사용 가능한 휴대폰번호입니다.");
				                $('#userPhone').css('border','1px solid #36ae36');
								//$('#addUserForm button').prop('disabled', false);
							}else {
								$('#phoneCheck').css('color','#f03f40');
				                $('#phoneCheck').html("* 이미 사용중인 휴대폰번호입니다.");
				                $('#userPhone').css('border','1px solid #f03f40');
								$('#userPhone').focus();
							}	
						}
					});
				}
			});
			

			
			
			
			
			
		});
		
		/* function DosignUp() {
		    
			var userId = $('#userId').val()
			var userPw = $('#userPw').val()
			var userPwCheck = $('#userPwCheck').val()
			var userName = $('#userName').val()
			var userNickname = $('#userNickname').val()
			var userGender = $('#userGender').val()
			var userEmail = $('#userEmail').val()
			var userPhone = $('#userPhone').val()
			var userAdress = $('#userAdress').val()
			var userAdress2 = $('#userAdress2').val()
			var userPoint = $('#userPoint').val()
			var userPenalty = $('#userPenalty').val()
			var userStatus = $('#userStatus').val()
			var userInfoKeep = $('#userInfoKeep').val()
		    
		    if(userId.length == 0){
		        alert("아이디를 입력해 주세요"); 
		        $("#userId").focus();
		        return false;
		    }
		    
		    if(userPw.length == 0){
		        alert("비밀번호를 입력해 주세요"); 
		        $("#userPw").focus();
		        return false;
		    }
		 
		    if(userPwCheck != inputPwdCfm){
		        alert("비밀번호가 서로 다릅니다. 비밀번호를 확인해 주세요."); 
		        $("#userPwCheck").focus();
		        return false; 
		    }
		 
		    if(userName.length == 0){
		        alert("이름을 입력해주세요");
		        $("#userName").focus();
		        return false;
		    }
		    
		    if(userNickname.length == 0){
		        alert("닉네임을 입력해주세요");
		        $("#userNickname").focus();
		        return false;
		    }
		    
		    if(userEmail.length == 0){
		        alert("이메일을 선택해주세요");
		        $("#userEmail").focus();
		        return false;
		    }
		    
		    if(userGender == null){
		        alert("성별을 입력해주세요");
		        $("#userGender").focus();
		        return false;
		    }
		    
		    if(userPhone.length == 0){
		        alert("휴대폰번호를 입력해주세요");
		        $("#userPhone").focus();
		        return false;
		    }
		    
		    if(userAdress.length == 0 || userAdress2.length == 0 ){
		        alert("주소를 입력해주세요");
		        $("#userAdress2").focus();
		        return false;
		    }
		    
		    if(userPoint.length == 0){
		        alert("포인트를 입력해주세요");
		        $("#userPoint").focus();
		        return false;
		    }
		    
		    if(userPenalty.length == 0){
		        alert("벌점을 입력해주세요");
		        $("#userPenalty").focus();
		        return false;
		    }
		    
		    if(userStatus.length == 0){
		        alert("상태를 선택해주세요");
		        $("#userStatus").focus();
		        return false;
		    }
		    
		    if(userInfoKeep.length == 0){
		        alert("정보보관기간을 선택해주세요");
		        $("#userInfoKeep").focus();
		        return false;
		    }
		    
		    if(confirm("회원가입을 하시겠습니까?")){
		        alert("회원가입 되었습니다.");
		        return true;
		    }
		} */
		
		
		
		
		
		
		
		

		

		//$('#addUserForm').submit(function(event) {});

    </script>
    
</th:block>

</html>
